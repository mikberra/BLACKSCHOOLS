<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Clean Blog - Start Bootstrap Theme</title>
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
        <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
        <style>
            body {
              background: url('./images/background.png') no-repeat center center fixed;
              background-size: cover; 
              margin: 0; 
              padding: 0; 
            }
          </style>
    </head>
    <body>
<!-- Navigation-->
    <nav class="navbar">
        <div class="t3">
            BLACK SCHOOLS
        </div>
        <div class="navbar-right">
            <button class="nav-button">Explore</button>
            <button class="nav-button">Contribute</button>
            <button class="nav-button">News</button>
        </div>
    </nav>
<!-- Masthead-->
    <div class="container-fluid px-0">
        <div class="row g-0 text-white">
            <!-- Left Column: 7/12 wide -->
            <div class="col-md-7 position-relative">
                <!-- Masthead Section -->
                <div class="masthead-overlay d-flex flex-column justify-content-end" style="background-image: url('./images/CS3_i1.png'); height: 80vh;">
                    <div class="text-overlay p-4">
                        <h4 id="school.address">Address</h4>
                        <t1 id="school.name">SCHOOL 1</t1>
                        <h5 id="school.condition">Characteristics</h5>
                    </div>
                </div>
            </div>
            <!-- Right Column: 5/12 wide -->
            <div class="col-md-5 position-relative">
                <!-- Mapbox Map as Background -->
                <div id="map" class="map-schools"></div>
                <script src="map.js"></script>
            </div>
        </div>
    </div>
<!-- Info-->
    <div class="container-fluid px-0">
        <div class="row gx-4 gx-lg-5 bg-dark text-white">
            <!-- Left Column: 7/12 wide -->
            <div class="col-md-7">
                <!-- Description Section -->
                <div class="p-4">
                    <div class="mb-4">
                        <t3>Summary</t3>
                        <p id="school.description.briefDescription"></p>
                    </div>
                    <div>
                        <t3>Notable People</t3>
                        <div class="row">
                            <div class="avatar-card">
                                    <img class="avatar" id="relevantFigures.figure1.image">
                                    <div class="avatar-text-content">
                                        <h5 id="relevantFigures.figure1.name" class="avatar-name"></h5>
                                        <p id="relevantFigures.figure1.role" class="avatar-title"></p>
                                        <p id="relevantFigures.figure1.briefDescription" class="avatar-description"></p>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: 5/12 wide -->
            <div class="col-md-5 nomargin">
                <!-- First Row -->
                <div class="row gx-4">
                    <!-- First Row, First Column -->
                    <div class="col-6">
                        <div class="p-4">
                            <t3>Current condition</t3>
                            <p id="school.condition">Current condition</p>
                            <p id="school.landmarked">Landmark status</p>
                            <p id="school.landmarkedBy">Landmarked by</p>
                            <p id="school.sign">Sign</p>
                            <p id="school.owner">Owner</p>
                        </div>
                    </div>
                    <!-- First Row, Second Column -->
                    <div class="col-6">
                        <div class="p-4">
                            <t3>Contributors</t3>
                            <p id="contacts.contributors.contributor1.organization"></p>
                            <p id="contacts.contributors.contributor2.organization"></p>
                            <p id="contacts.contributors.contributor3.organization"></p>
                            <p id="contacts.contributors.contributor4.organization"></p>
                            <p id="contacts.contributors.contributor5.organization"></p>
                        </div>
                    </div>
                </div>

                <!-- Second Row -->
                <div class="row gx-4">
                    <!-- Second Row, First Column -->
                    <div class="col-6">
                        <div class="p-4">
                            <t3>Quick dates</t3>
                            <p id="school.description.yearInstitutionCreation">Institution creation</p>
                            <p id="school.description.yearBuildingStarted">Building started</p>
                            <p id="school.description.yearBuildingEnded">Building ended</p>
                            <p id="school.description.yearDesegregation">Desegregation</p>
                            <p id="school.description.yearCeased">Ceased operation</p>
                            <p id="school.description.yearDemolished">Demolished</p>
                        </div>
                    </div>
                    <!-- Second Row, Second Column -->
                    <div class="col-6">
                        <div class="p-4">
                            <t3>Names over time</t3>
                            <p id="school.otherNames.name1">Other name 1</p>
                            <p id="school.otherNames.name2">Other name 2</p>
                            <p id="school.otherNames.name3">Other name 3</p>
                            <p id="school.otherNames.name4">Other name 4</p>
                            <p id="school.otherNames.name5">Other name 5</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Timeline-->
    <article class="mb-4 bg-primary">
        <div class="container-fluid px-4 px-lg-5">
            <div class="row">
                <t1>Timeline</t1>
            </div>
            <div class="row gx-4 gx-lg-5">
                <div class="col-md-7"></div>
                <div class="col-md-5 position-relative">
                    <div class="sticky-top-buttons">
                        <button id="buttonA" class="active" onclick="toggleContent('A')">Maps</button>
                        <button id="buttonB" onclick="toggleContent('B')">Historical context</button>
                    </div>
            </div>
    </article>
<!-- Decade 1 -->
<div id="timeline-container" class="container-fluid px-4 px-lg-5"></div>

<!-- Components-->   
    <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
        <script src="js/scripts.js"></script>    
    <!-- On-off button -->    
        <script>
            function toggleContent(content) {
                // Select all content elements
                const contentAElements = document.querySelectorAll('.contentA');
                const contentBElements = document.querySelectorAll('.contentB');
                
                // Select the buttons
                const buttonA = document.getElementById('buttonA');
                const buttonB = document.getElementById('buttonB');
        
                if (content === 'A') {
                    contentAElements.forEach(el => el.classList.remove('d-none'));
                    contentBElements.forEach(el => el.classList.add('d-none'));
                    buttonA.classList.add('active');
                    buttonB.classList.remove('active');
                } else if (content === 'B') {
                    contentAElements.forEach(el => el.classList.add('d-none'));
                    contentBElements.forEach(el => el.classList.remove('d-none'));
                    buttonA.classList.remove('active');
                    buttonB.classList.add('active');
                }
            }
        </script>


    <!-- Timeline elements script -->
        <script>
            const decades = 10; // Number of decades
            const container = document.getElementById("timeline-container");

            for (let i = 1; i <= decades; i++) {
                const html = `
                    <div class="row gx-3 gx-lg-3">
                        <!-- School event -->
                        <div class="col-md-7 pe-5">
                            <section>
                                <div class="row align-items-center">
                                    <div class="col-md-2">
                                        <h3 id="school.timeline.event${i}.year" class="event-year"></h3>
                                    </div>
                                    <div class="col-md-10">
                                        <h2 id="school.timeline.event${i}.title"></h2>
                                    </div>
                                </div>
                                <div class="col-md-1"></div>
                                <div class="col-md-11 timeline-box">
                                    <p id="school.timeline.event${i}.briefDescription"></p>
                                    <div id="school.timeline.event${i}.sources-container" style="display: none;">
                                        <p class="source-text">
                                            <span class="source-label">Source: </span>
                                            <span id="school.timeline.event${i}.sources"></span>
                                        </p>
                                    </div>
                                    <img id="school.timeline.event${i}.image" class="img-fluid" />
                                    <p id="school.timeline.event${i}.footnote"></p>
                                    <div id="school.timeline.event${i}.imageSources-container" style="display: none;">
                                        <p class="source-text">
                                            <span class="source-label">Source: </span>
                                            <span id="school.timeline.event${i}.imageSources"></span>
                                        </p>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <!-- Context map and event -->
                        <div class="col-md-5">
                            <!-- Context map -->
                            <div class="contentA mt-3">
                                <section class="parallax">
                                    <img id="maps.map${i}.image" alt="Parallax Background">
                                </section>
                            </div>
                            <!-- Context event -->
                            <div class="contentB mt-3 d-none text-dark">
                                <section>
                                    <div class="row align-items-center">
                                        <div class="col-md-2">
                                            <h4 id="ctxt.timeline.event${i}.year"></h4>
                                        </div>
                                        <div class="col-md-10">
                                            <h3 id="ctxt.timeline.event${i}.title"></h3>
                                        </div>
                                    </div>
                                    <div class="timeline-box">
                                        <p id="ctxt.timeline.event${i}.briefDescription"></p>
                                        <div id="ctxt.timeline.event${i}.sources-container" style="display: none;">
                                            <p class="source-text">
                                                <span class="source-label">Source: </span>
                                                <span id="ctxt.timeline.event${i}.sources"></span>
                                            </p>
                                        </div>
                                        <img id="ctxt.timeline.event${i}.image" class="img-fluid" />
                                        <p id="ctxt.timeline.event${i}.footnote"></p>
                                        <div id="ctxt.timeline.event${i}.imageSources-container" style="display: none;">
                                            <p class="source-text">
                                                <span class="source-label">Source: </span>
                                                <span id="ctxt.timeline.event${i}.imageSources"></span>
                                            </p>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            }
        </script>

    <!-- Pulling all info script -->
        <script>
            window.onload = async function () {
                const schoolId = "6756041d7dc1fb8687a92dff"; // Replace with the School API _id
                const contextId = "6755f8497dc1fb8687a92dfb"; // Replace with the Context API _id
                await fetchData(schoolId, contextId);
            };

            async function fetchData(schoolId, contextId) {
                const schoolApiUrl = 'http://localhost:3000/api/formdata';
                const contextApiUrl = 'http://localhost:3000/api/formdata_context';

                try {
                    // Fetch school data
                    const schoolResponse = await fetch(schoolApiUrl);
                    if (!schoolResponse.ok) throw new Error("Failed to fetch school data.");
                    const schoolData = await schoolResponse.json();
                    const schoolEntry = schoolData.find(item => item._id === schoolId);

                    // Fetch context data
                    const contextResponse = await fetch(contextApiUrl);
                    if (!contextResponse.ok) throw new Error("Failed to fetch context data.");
                    const contextData = await contextResponse.json();
                    const contextEntry = contextData.find(item => item._id === contextId);

                    // Update the DOM with fetched data
                    updateData(schoolEntry, contextEntry);
                } catch (error) {
                    console.error("Error fetching data:", error);
                }
            }

            function updateData(schoolEntry, contextEntry) {
                // Update or hide elements
                function updateOrHide(id, value, isImage = false) {
                    const element = document.getElementById(id);
                    const containerElement = document.getElementById(id + '-container');
                    
                    if (element) {
                        if (value) {
                            if (isImage) {
                                element.src = '/' + value;
                                element.style.display = '';
                            } else {
                                element.textContent = value;
                                element.style.display = '';
                                // Show the container with "Source:" label if it exists
                                if (containerElement && (id.endsWith('.sources') || id.endsWith('.imageSources'))) {
                                    containerElement.style.display = '';
                                }
                            }
                        } else {
                            element.style.display = 'none';
                            // Hide the container with "Source:" label if it exists
                            if (containerElement) {
                                containerElement.style.display = 'none';
                            }
                        }
                    }
                }

                if (schoolEntry) {
                    // General Information (non-image updates)
                    updateOrHide('generalInformation.areaOfWork', schoolEntry.generalInformation?.areaOfWork);
                    updateOrHide('generalInformation.city', schoolEntry.generalInformation?.city);
                    updateOrHide('generalInformation.county', schoolEntry.generalInformation?.county);
                    updateOrHide('generalInformation.neighborhood', schoolEntry.generalInformation?.neighborhood);
                    updateOrHide('generalInformation.state', schoolEntry.generalInformation?.state);

                    // School Details (non-image updates)
                    updateOrHide('school.name', schoolEntry.school?.name);
                    updateOrHide('school.address', schoolEntry.school?.address);
                    updateOrHide('school.condition', schoolEntry.school?.condition);
                    updateOrHide('school.description.briefDescription', schoolEntry.school?.description?.briefDescription);

                    // Images - Note the isImage flag set to true
                    updateOrHide('school.description.image', schoolEntry.school?.description?.image, true);

                    // Timeline Events
                    for (let i = 1; i <= 10; i++) {
                        updateOrHide(`school.timeline.event${i}.title`, schoolEntry.school?.timeline[`event${i}`]?.title);
                        updateOrHide(`school.timeline.event${i}.year`, schoolEntry.school?.timeline[`event${i}`]?.year);
                        updateOrHide(`school.timeline.event${i}.briefDescription`, schoolEntry.school?.timeline[`event${i}`]?.briefDescription);
                        updateOrHide(`school.timeline.event${i}.sources`, schoolEntry.school?.timeline[`event${i}`]?.sources);
                        updateOrHide(`school.timeline.event${i}.footnote`, schoolEntry.school?.timeline[`event${i}`]?.footnote);
                        updateOrHide(`school.timeline.event${i}.image`, schoolEntry.school?.timeline[`event${i}`]?.image, true);
                        updateOrHide(`school.timeline.event${i}.imageSources`, schoolEntry.school?.timeline[`event${i}`]?.imageSources);
                    }

                    // Relevant Figures
                    for (let i = 1; i <= 5; i++) {
                        updateOrHide(`relevantFigures.figure${i}.name`, schoolEntry.relevantFigures?.[`figure${i}`]?.name);
                        updateOrHide(`relevantFigures.figure${i}.role`, schoolEntry.relevantFigures?.[`figure${i}`]?.role);
                        updateOrHide(`relevantFigures.figure${i}.briefDescription`, schoolEntry.relevantFigures?.[`figure${i}`]?.briefDescription);
                        updateOrHide(`relevantFigures.figure${i}.image`, schoolEntry.relevantFigures?.[`figure${i}`]?.image, true);
                    }

                    // Maps
                    for (let i = 1; i <= 10; i++) {
                        updateOrHide(`maps.map${i}.title`, schoolEntry.maps?.[`map${i}`]?.title);
                        updateOrHide(`maps.map${i}.decade`, schoolEntry.maps?.[`map${i}`]?.decade);
                        updateOrHide(`maps.map${i}.briefDescription`, schoolEntry.maps?.[`map${i}`]?.briefDescription);
                        updateOrHide(`maps.map${i}.sources`, schoolEntry.maps?.[`map${i}`]?.sources);
                        updateOrHide(`maps.map${i}.footnote`, schoolEntry.maps?.[`map${i}`]?.footnote);
                        updateOrHide(`maps.map${i}.image`, schoolEntry.maps?.[`map${i}`]?.image, true);
                        updateOrHide(`maps.map${i}.imageSources`, schoolEntry.maps?.[`map${i}`]?.imageSources);
                    }
                }

                if (contextEntry) {
                    // Context Information
                    updateOrHide('ctxt.generalInformation.areaOfWork', contextEntry.generalInformation?.areaOfWork);
                    updateOrHide('ctxt.generalInformation.city', contextEntry.generalInformation?.city);
                    updateOrHide('ctxt.generalInformation.county', contextEntry.generalInformation?.county);
                    updateOrHide('ctxt.generalInformation.neighborhood', contextEntry.generalInformation?.neighborhood);
                    updateOrHide('ctxt.generalInformation.state', contextEntry.generalInformation?.state);

                    // Context Timeline
                    for (let i = 1; i <= 10; i++) {
                        updateOrHide(`ctxt.timeline.event${i}.title`, contextEntry.timeline?.[`event${i}`]?.title);
                        updateOrHide(`ctxt.timeline.event${i}.year`, contextEntry.timeline?.[`event${i}`]?.year);
                        updateOrHide(`ctxt.timeline.event${i}.briefDescription`, contextEntry.timeline?.[`event${i}`]?.briefDescription);
                        updateOrHide(`ctxt.timeline.event${i}.sources`, contextEntry.timeline?.[`event${i}`]?.sources);
                        updateOrHide(`ctxt.timeline.event${i}.image`, contextEntry.timeline?.[`event${i}`]?.image, true);
                    }
                }
            }
        </script>  
    </body>
</html>